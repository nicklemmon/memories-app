language: node_js

node_js:
  - 10.8

cache:
  directories:
    - ~/.npm
    - ~/.cache
  override:
    - npm ci

addons:
  artifacts:
    debug: true
    baseDirectory: cypress
    files:
      - '**/*.png'
      - '**/*.mp4'

  apt:
    packages:
      # Ubuntu 16+ does not install this dependency by default, so we need to install it ourselves
      - libgconf-2-4

script:
  - npm run test
  - npm run build
  - npm run test:cy:ci

before_deploy:
  - rm -rf build
  - npm i
  - npm install netlify-cli -g
  - npm run build

deploy:
  provider: script
  script: netlify deploy -s $NETLIFY_SITE_ID --auth $NETLIFY_ACCESS_TOKEN --prod --dir ./build
  skip_cleanup: true
  on:
    branch: master
